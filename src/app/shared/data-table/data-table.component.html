<div class="data-table">
  <!-- Header -->
  <div class="data-table__header">
    @if (searchEnabled) {
      <div class="data-table__search">
        <input
          type="text"
          placeholder="Buscar..."
          [value]="searchTerm()"
          (input)="updateSearch($event)"
          class="data-table__search-input"
        />
        <span class="material-icons">search</span>
      </div>
    }
  </div>

  <!-- Content -->
  <div class="data-table__content" [class.loading]="loading">
    <table>
      <thead>
        <tr>
          @for (column of columns; track column.key) {
            <th>{{ column.label }}</th>
          }
          <th class="actions-column">Acciones</th>
        </tr>
      </thead>

      <tbody>
        @if (loading) {
          <tr>
            <td [attr.colspan]="columns.length + 1" class="loading-cell">
              <div class="loading-spinner"></div>
              Cargando datos...
            </td>
          </tr>
        } @else if (paginatedData.length === 0) {
          <tr>
            <td [attr.colspan]="columns.length + 1" class="empty-cell">
              No se encontraron datos
            </td>
          </tr>
        } @else {
          @for (item of paginatedData; track $index) {
            <tr class="data-row">
              @for (column of columns; track column.key) {
                <td class="data-cell">
                  @if (!column.format) {
                    {{ item[column.key] || 'N/A' }}
                  } @else {
                    {{ column.format(item[column.key]) || 'N/A' }}
                  }
                </td>
              }

              <td class="actions-cell">
                <button
                  type="button"
                  class="action-button view-button"
                  (click)="onView(item)"
                  aria-label="Ver detalles">
                  <span class="material-icons">visibility</span>
                </button>

                <button
                  type="button"
                  class="action-button edit-button"
                  (click)="onEdit(item)"
                  aria-label="Editar">
                  <span class="material-icons">edit</span>
                </button>

                <button
                  type="button"
                  class="action-button delete-button"
                  (click)="onDelete(item)"
                  aria-label="Eliminar">
                  <span class="material-icons">delete</span>
                </button>

                @if (showBanUnban && item['is_active']) {
                  <button
                    type="button"
                    class="action-button ban-button"
                    (click)="onBan(item)"
                    aria-label="Banear">
                    <span class="material-icons">block</span>
                  </button>
                } @else if (showBanUnban && !item['is_active']) {
                  <button
                    type="button"
                    class="action-button unban-button"
                    (click)="onUnban(item)"
                    aria-label="Desbanear">
                    <span class="material-icons">check_circle</span>
                  </button>
                }
              </td>
            </tr>
          }
        }
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  @if (pagination && totalPages > 1) {
    <div class="data-table__pagination">
      <button
        [disabled]="currentPage === 1"
        (click)="changePage(currentPage - 1)"
        aria-label="Página anterior"
        class="pagination-button">
        <span class="material-icons">chevron_left</span>
      </button>

      <span class="pagination-info">
        Página {{ currentPage }} de {{ totalPages }}
      </span>

      <button
        [disabled]="currentPage === totalPages"
        (click)="changePage(currentPage + 1)"
        aria-label="Página siguiente"
        class="pagination-button">
        <span class="material-icons">chevron_right</span>
      </button>
    </div>
  }
</div>
