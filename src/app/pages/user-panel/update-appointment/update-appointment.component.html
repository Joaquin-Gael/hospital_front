<div class="update-appointment">
  @if (isLoading) {
    <div class="loading-spinner">
      <i class="material-icons loading-icon">hourglass_empty</i>
      <span>Cargando datos del turno...</span>
    </div>
  } @else {
    @if (appointment) {
      <h2 class="page-title">Reprogramar turno</h2>
      <p class="page-subtitle">Estás reprogramando un turno para {{ appointment.specialty }} con {{ appointment.doctorName }}</p>

      <form [formGroup]="appointmentForm">
        <app-date-selection
          [dateControl]="dateControl"
          [minDate]="minDate"
          [dayFilter]="dayFilter"
          [isLoading]="isLoading"
          [error]="error"
        ></app-date-selection>

        @if (availableTimeSlots.length > 0) {
          <app-time-selection
            [timeControl]="timeControl"
            [availableTimeSlots]="availableTimeSlots"
            [isLoading]="isLoading"
            [error]="error"
          ></app-time-selection>
        }

        <div class="form-actions">
          <button type="button" class="btn btn--outline" (click)="router.navigate(['/user-panel'])">Cancelar</button>
          <button type="submit" class="btn btn--primary" [disabled]="appointmentForm.invalid">Confirmar reprogramación</button>
        </div>
      </form>
    } @else {
      <div class="error-state">
        <h2>Error</h2>
        <p>No se pudo cargar el turno. Por favor, intenta de nuevo.</p>
        <button class="btn btn--primary" (click)="router.navigate(['/user-panel'])">Volver al panel</button>
      </div>
    }
  }
</div>