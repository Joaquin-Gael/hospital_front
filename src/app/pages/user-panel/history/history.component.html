<section>
  @if (localLoading) {
    <app-loading-spinner [message]="'Cargando historial...'"></app-loading-spinner>
  } @else {
    @if (error) {
      <div class="error-state">
        <p>{{ error }}</p>
      </div>
    } @else {
      <div class="table-container">
        <app-data-table
          [data]="filteredAppointments"
          [columns]="tableColumns"
          [loading]="localLoading"
          [enableDownloadReceipt]="true"
          [downloadLoading]="isDownloadingAny"
          (view)="onViewDetails($event)"
          (download)="onDownloadReceipt($event)">
        </app-data-table>
      </div>
    }
  }

  <!-- ViewDialog para mostrar detalles de la cita -->
  @if (viewDialogOpen) {
    <app-view-dialog
      [isOpen]="viewDialogOpen"
      [title]="viewDialogTitle"
      [item]="viewDialogItem"
      [columns]="viewDialogColumns"
      (close)="closeViewDialog()">
    </app-view-dialog>
  }
</section>
