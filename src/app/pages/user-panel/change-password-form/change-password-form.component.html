<div class="change-password-form">
  <div class="change-password-form__header">
    <h2 class="change-password-form__title">
      <i class="fas fa-key change-password-form__title-icon"></i>
      Cambiar Contraseña
    </h2>
    <p class="change-password-form__description">
      Actualiza tu contraseña para mantener tu cuenta segura
    </p>
  </div>

  <form [formGroup]="changePasswordForm" (ngSubmit)="onSubmit()" class="change-password-form__form" novalidate>
    
    <!-- Security Notice -->
    <div class="security-notice">
      <div class="security-notice__icon">
        <i class="fas fa-shield-alt"></i>
      </div>
      <div class="security-notice__content">
        <h4 class="security-notice__title">Recomendaciones de seguridad</h4>
        <ul class="security-notice__list">
          <li>Usa al menos 8 caracteres</li>
          <li>Incluye mayúsculas, minúsculas y números</li>
          <li>Agrega símbolos especiales (&#33;&#64;&#35;&#36;&#37;&#94;&#38;&#42;)</li>
          <li>No uses información personal</li>
        </ul>
      </div>
    </div>

    <!-- Form Fields -->
    <div class="change-password-form__fields">
      
      <!-- Current Password -->
      <div class="form-field">
        <label class="form-field__label" for="currentPassword">
          Contraseña actual
          <span class="form-field__required">*</span>
        </label>
        <div class="form-field__input-container">
          <input 
            [type]="showCurrentPassword ? 'text' : 'password'"
            id="currentPassword"
            class="form-field__input"
            formControlName="currentPassword"
            placeholder="Ingresa tu contraseña actual"
          />
          <button 
            type="button"
            class="form-field__toggle-password"
            (click)="toggleCurrentPasswordVisibility()"
          >
            <i [class]="showCurrentPassword ? 'fas fa-eye-slash' : 'fas fa-eye'"></i>
          </button>
        </div>
        @if (changePasswordForm.get('currentPassword')?.invalid && changePasswordForm.get('currentPassword')?.touched) {
          <div class="form-field__error">
            <i class="fas fa-exclamation-triangle"></i>
            {{ getFieldError('currentPassword') }}
          </div>
        }
      </div>

      <!-- New Password -->
      <div class="form-field">
        <label class="form-field__label" for="newPassword">
          Nueva contraseña
          <span class="form-field__required">*</span>
        </label>
        <div class="form-field__input-container">
          <input 
            [type]="showNewPassword ? 'text' : 'password'"
            id="newPassword"
            class="form-field__input"
            formControlName="newPassword"
            placeholder="Ingresa tu nueva contraseña"
          />
          <button 
            type="button"
            class="form-field__toggle-password"
            (click)="toggleNewPasswordVisibility()"
          >
            <i [class]="showNewPassword ? 'fas fa-eye-slash' : 'fas fa-eye'"></i>
          </button>
        </div>
        @if (changePasswordForm.get('newPassword')?.invalid && changePasswordForm.get('newPassword')?.touched) {
          <div class="form-field__error">
            <i class="fas fa-exclamation-triangle"></i>
            {{ getFieldError('newPassword') }}
          </div>
        }
        
        <!-- Password Strength Indicator -->
        @if (changePasswordForm.get('newPassword')?.value) {
          <div class="password-strength">
            <div class="password-strength__label">Seguridad de la contraseña:</div>
            <div class="password-strength__bar">
              <div 
                class="password-strength__fill" 
                [class]="'password-strength__fill--' + passwordStrength.level"
                [style.width.%]="passwordStrength.percentage"
              ></div>
            </div>
            <span class="password-strength__text" [class]="'password-strength__text--' + passwordStrength.level">
              {{ passwordStrength.text }}
            </span>
          </div>
        }
      </div>

      <!-- Confirm New Password -->
      <div class="form-field">
        <label class="form-field__label" for="confirmPassword">
          Confirmar nueva contraseña
          <span class="form-field__required">*</span>
        </label>
        <div class="form-field__input-container">
          <input 
            [type]="showConfirmPassword ? 'text' : 'password'"
            id="confirmPassword"
            class="form-field__input"
            formControlName="confirmPassword"
            placeholder="Confirma tu nueva contraseña"
          />
          <button 
            type="button"
            class="form-field__toggle-password"
            (click)="toggleConfirmPasswordVisibility()"
          >
            <i [class]="showConfirmPassword ? 'fas fa-eye-slash' : 'fas fa-eye'"></i>
          </button>
        </div>
        @if (changePasswordForm.get('confirmPassword')?.invalid && changePasswordForm.get('confirmPassword')?.touched) {
          <div class="form-field__error">
            <i class="fas fa-exclamation-triangle"></i>
            {{ getFieldError('confirmPassword') }}
          </div>
        }
        @if (changePasswordForm.errors?.['passwordMismatch'] && changePasswordForm.get('confirmPassword')?.touched) {
          <div class="form-field__error">
            <i class="fas fa-exclamation-triangle"></i>
            Las contraseñas no coinciden
          </div>
        }
      </div>

    </div>

    <!-- Form Actions -->
    <div class="change-password-form__actions">
      <button 
        type="button"
        class="change-password-form__button change-password-form__button--secondary"
        (click)="onCancel()"
        [disabled]="isSubmitting"
      >
        <i class="fas fa-times"></i>
        Cancelar
      </button>
      
      <button 
        type="submit"
        class="change-password-form__button change-password-form__button--primary"
        [disabled]="changePasswordForm.invalid || isSubmitting"
      >
        @if (isSubmitting) {
          <i class="fas fa-spinner fa-spin"></i>
        } @else {
          <i class="fas fa-key"></i>
        }
        {{ isSubmitting ? 'Cambiando...' : 'Cambiar contraseña' }}
      </button>
    </div>

  </form>
</div>