<div class="department-section">
  <app-section-header
    title="Gestión de Departamentos"
    subtitle="Administra los departamentos del sistema médico"
    icon="business"
    [actions]="headerActions">
  </app-section-header>

  <app-error-message 
    [message]="error" 
    (close)="error = null">
  </app-error-message>

  @if (showForm) {
    <div class="department-section__form-container">
      <app-entity-form
        [fields]="formFields"
        [initialData]="formInitialData"
        [title]="formMode === 'create' ? 'Nuevo Departamento' : 'Editar Departamento'"
        [submitLabel]="formMode === 'create' ? 'Crear' : 'Actualizar'"
        [loading]="formLoading"
        (formSubmit)="onFormSubmit($event)"
        (formCancel)="onFormCancel()">
      </app-entity-form>
    </div>
  } @else {
    @if (loading) {
      <app-loading-spinner [message]="'Cargando departamentos...'"></app-loading-spinner>
    } @else {
      <div class="filters">
        <div class="filters__group">
          <label class="filters__label" for="department-search">Búsqueda</label>
          <input
            id="department-search"
            class="filters__input"
            type="text"
            [value]="searchTerm"
            (input)="searchTerm = $any($event.target).value"
            placeholder="Buscar por nombre o descripción"
          />
        </div>

        <div class="filters__group">
          <label class="filters__label" for="location-filter">Ubicación</label>
          <select
            id="location-filter"
            class="filters__select"
            [value]="locationFilter"
            (change)="locationFilter = $any($event.target).value"
          >
            <option value="all">Todas</option>
            <option *ngFor="let location of locations" [value]="location.id">
              {{ location.name }}
            </option>
          </select>
        </div>
      </div>

      <div class="department-section__table-container">
        <app-data-table
          [data]="filteredDepartments"
          [columns]="tableColumns"
          [loading]="loading"
          (edit)="onEdit($event)"
          (delete)="onDelete($event)"
          (view)="onView($event)">
        </app-data-table>
      </div>
    }
  }

  <app-view-dialog
    [isOpen]="viewDialogOpen"
    [item]="viewDialogData"
    [columns]="viewDialogColumns"
    [title]="viewDialogTitle"
    (close)="closeViewDialog()">
  </app-view-dialog>
</div>