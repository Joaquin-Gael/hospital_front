<div class="cashes-section">
  <app-section-header
    title="Pagos"
    subtitle="Administra los pagos registrados por las pasarelas"
    icon="payments"
    headerClass="header-indigo"
    [actions]="headerActions"
  ></app-section-header>

  <div class="legacy-hint">
    <span class="material-icons" aria-hidden="true">history</span>
    Las creaciones/ediciones manuales de caja pertenecen a un flujo heredado. Desde aqu√≠ solo se
    listan pagos y se actualiza su estado.
  </div>

  @if (showStatusForm()) {
    <div class="cashes-section__form">
      <app-entity-form
        [fields]="statusFormFields"
        [initialData]="statusFormInitialData"
        [mode]="statusFormMode()"
        [loading]="formLoading()"
        title="Actualizar estado del pago"
        submitLabel="Guardar cambios"
        (formSubmit)="onStatusFormSubmit($event)"
        (formCancel)="onFormCancel()"
      ></app-entity-form>
    </div>
  } @else {
    <div class="cashes-section__content">
      <app-error-message *ngIf="error()" [message]="error()"></app-error-message>

      <div class="filters">
        <div class="filters__group">
          <label class="filters__label" for="user-filter">Usuario</label>
          <input
            id="user-filter"
            class="filters__input"
            type="text"
            placeholder="ID o email"
            [value]="userFilter()"
            (input)="userFilter.set($any($event.target).value)"
            (change)="onFiltersChange()"
          />
        </div>

        <div class="filters__group">
          <label class="filters__label" for="status-filter">Estado</label>
          <select
            id="status-filter"
            class="filters__select"
            [value]="statusFilter()"
            (change)="statusFilter.set($any($event.target).value); onFiltersChange()"
          >
            <option value="all">Todos</option>
            @for (status of defaultStatuses; track status) {
              <option [value]="status">{{ formatStatus(status) }}</option>
            }
          </select>
        </div>

        <div class="filters__actions">
          <button type="button" class="btn btn-secondary" (click)="loadData()">
            <span class="material-icons" aria-hidden="true">refresh</span>
            Aplicar
          </button>
        </div>
      </div>

      <app-data-table
        [columns]="tableColumns"
        [data]="filteredPayments()"
        [loading]="loading()"
        [actions]="tableActions"
        (view)="onView($event)"
        (edit)="onEdit($event)"
        (delete)="onDelete($event)"
        [pagination]="true"
      ></app-data-table>

      <app-loading-spinner *ngIf="loading()"></app-loading-spinner>
    </div>
  }

  <app-view-dialog
    [isOpen]="viewDialogOpen()"
    [item]="viewDialogData"
    [columns]="viewDialogColumns"
    [title]="viewDialogTitle()"
    (close)="closeViewDialog()"
  ></app-view-dialog>
</div>
