<div class="cashes-section">
  <app-section-header
    title="Caja - Movimientos"
    subtitle="Administra los movimientos de caja del sistema"
    icon="payments"
    headerClass="header-indigo"
    [actions]="headerActions"
  ></app-section-header>

  @if (showForm()) {
    <div class="cashes-section__form">
      <app-entity-form
        [fields]="formFields"
        [initialData]="formInitialData"
        [mode]="formMode()"
        [loading]="formLoading()"
        [title]="formMode() === 'create' ? 'Nueva transacci칩n' : 'Editar transacci칩n'"
        [submitLabel]="formMode() === 'create' ? 'Crear' : 'Guardar cambios'"
        (formSubmit)="onFormSubmit($event)"
        (formCancel)="onFormCancel()"
      ></app-entity-form>
    </div>
  } @else {
    <div class="cashes-section__content">
      <app-error-message *ngIf="error()" [message]="error()"></app-error-message>

      <!-- Filtros adaptados -->
      <div class="filters">
        <div class="filters__group">
          <label class="filters__label" for="type-filter">Tipo de Transacci칩n</label>
          <select
            id="type-filter"
            class="filters__select"
            [value]="transactionTypeFilter()"
            (change)="onTransactionTypeFilterChange($any($event.target).value)"
          >
            <option value="all">Todos</option>
            <option value="income">Ingresos</option>
            <option value="expense">Egresos</option>
          </select>
        </div>

        <div class="filters__group">
          <label class="filters__label" for="date-filter">Fecha</label>
          <input
            id="date-filter"
            class="filters__input"
            type="date"
            [value]="dateFilter()"
            (input)="onDateFilterChange($any($event.target).value)"
          />
        </div>

        <div class="filters__actions">
          <button type="button" class="btn btn-secondary" (click)="resetFilters()">
            <span class="material-icons" aria-hidden="true">restart_alt</span>
            Limpiar
          </button>
        </div>
      </div>

      <!-- Tabla de datos -->
      <app-data-table
        [columns]="tableColumns"
        [data]="filteredCashes()"
        [loading]="loading()"
        [actions]="tableActions"
        (view)="onView($event)"
        (edit)="onEdit($event)"
        [pagination]="true"
      ></app-data-table>

      <app-loading-spinner *ngIf="loading()"></app-loading-spinner>
    </div>
  }

  <!-- Di치logo de vista detallada -->
  <app-view-dialog
    [isOpen]="viewDialogOpen()"
    [item]="viewDialogData"
    [columns]="viewDialogColumns"
    [title]="viewDialogTitle()"
    (close)="closeViewDialog()"
  ></app-view-dialog>
</div>