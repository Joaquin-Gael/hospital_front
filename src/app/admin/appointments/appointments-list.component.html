<div class="appointments-section">
  <app-section-header
    title="Turnos y Citas"
    subtitle="Administra las reservas de pacientes"
    icon="event"
    [actions]="headerActions">
  </app-section-header>

  <app-error-message
    *ngIf="error"
    [message]="error"
    (close)="error = null">
  </app-error-message>

  @if (showForm) {
    <div class="appointments-section__form-container">
      <app-entity-form
        [fields]="formFields"
        [initialData]="formInitialData"
        [title]="formMode === 'create' ? 'Nuevo turno' : 'Editar turno'"
        [submitLabel]="formMode === 'create' ? 'Crear' : 'Guardar cambios'"
        [loading]="formLoading"
        (formSubmit)="onFormSubmit($event)"
        (formCancel)="onFormCancel()">
      </app-entity-form>
    </div>
  } @else {
    @if (loading) {
      <app-loading-spinner [message]="'Cargando turnos...'"></app-loading-spinner>
    } @else {
      <div class="appointments-section__table-container">
        <app-data-table
          [data]="appointments"
          [columns]="tableColumns"
          [loading]="loading"
          [searchEnabled]="true"
          [pagination]="true"
          (view)="onView($event)"
          (edit)="onEdit($event)"
          (delete)="onDelete($event)">
        </app-data-table>
      </div>
    }
  }

  <app-view-dialog
    [isOpen]="viewDialogOpen"
    [item]="viewDialogData"
    [columns]="viewDialogColumns"
    [title]="viewDialogTitle"
    (close)="closeViewDialog()">
  </app-view-dialog>
</div>