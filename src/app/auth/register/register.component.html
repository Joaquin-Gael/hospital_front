<div class="register-container">
  <div class="register-card">
    <div class="register-header">
      <div class="logo">
        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M22 12h-4l-3 9L9 3l-3 9H2"></path>
        </svg>
      </div>
      <h1>Registro de Paciente</h1>
      <p>Complete sus datos para crear una cuenta</p>
    </div>

    <!-- Disclaimer legal simplificado -->
    <div class="legal-notice">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
      </svg>
      <p>Los datos proporcionados deben ser verídicos. La falsificación de información médica puede imposibilitar la prestación de servicios.</p>
    </div>

    <form [formGroup]="registerForm" (ngSubmit)="onRegister()" class="register-form">
      @if (isSubmitting) {
        <!-- Indicador de progreso simple -->
        <div class="form-progress">
          <div class="progress-bar">
            <div class="progress-fill"></div>
          </div>
          <span class="progress-text">Procesando registro...</span>
        </div>
      }

      <!-- Datos personales -->
      <div class="form-section">
        <h3 class="section-title">Datos personales</h3>
        
        <div class="form-row">
          <div class="form-group">
            <label for="first_name" class="form-label">
              Nombre <span class="required">*</span>
            </label>
            <input 
              type="text" 
              id="first_name" 
              formControlName="first_name" 
              placeholder="Ingrese su nombre"
              class="form-input"
              [class.form-input--error]="registerForm.get('first_name')?.invalid && registerForm.get('first_name')?.touched"
            >
            @if (registerForm.get('first_name')?.invalid && registerForm.get('first_name')?.touched) {
              <div class="error-message">
                El nombre es requerido
              </div>
            }
          </div>

          <div class="form-group">
            <label for="last_name" class="form-label">
              Apellido <span class="required">*</span>
            </label>
            <input 
              type="text" 
              id="last_name" 
              formControlName="last_name" 
              placeholder="Ingrese su apellido"
              class="form-input"
              [class.form-input--error]="registerForm.get('last_name')?.invalid && registerForm.get('last_name')?.touched"
            >
            @if (registerForm.get('last_name')?.invalid && registerForm.get('last_name')?.touched) {
              <div class="error-message">
                El apellido es requerido
              </div>
            }
          </div>
        </div>

        <div class="form-group">
          <label for="dni" class="form-label">
            DNI <span class="required">*</span>
          </label>
          <input 
            type="text" 
            id="dni" 
            formControlName="dni" 
            placeholder="12345678"
            class="form-input"
            [class.form-input--error]="registerForm.get('dni')?.invalid && registerForm.get('dni')?.touched"
            maxlength="8"
          >
          @if (registerForm.get('dni')?.invalid && registerForm.get('dni')?.touched) {
            <div class="error-message">
              @if (registerForm.get('dni')?.errors?.['required']) {
                <span>El DNI es requerido</span>
              }
              @if (registerForm.get('dni')?.errors?.['pattern']) {
                <span>El DNI debe tener 8 dígitos</span>
              }
            </div>
          }
        </div>

        <div class="form-group">
          <label for="email" class="form-label">
            Correo electrónico <span class="required">*</span>
          </label>
          <input 
            type="email" 
            id="email" 
            formControlName="email" 
            placeholder="ejemplo@correo.com"
            class="form-input"
            [class.form-input--error]="registerForm.get('email')?.invalid && registerForm.get('email')?.touched"
          >
          @if (registerForm.get('email')?.invalid && registerForm.get('email')?.touched) {
            <div class="error-message">
              @if (registerForm.get('email')?.errors?.['required']) {
                <span>El correo electrónico es requerido</span>
              }
              @if (registerForm.get('email')?.errors?.['email']) {
                <span>Ingrese un correo electrónico válido</span>
              }
            </div>
          }
        </div>
      </div>

      <!-- Información médica -->
      <div class="form-section">
        <h3 class="section-title">Información médica</h3>
        
        <div class="form-group">
          <label for="blood_type" class="form-label">
            Tipo de sangre <span class="optional">(Opcional)</span>
          </label>
          <select 
            id="blood_type" 
            formControlName="blood_type" 
            class="form-select"
          >
            <option value="">Seleccione su tipo de sangre</option>
            @for (option of bloodTypeOptions; track option.value) {
              <option [value]="option.value">
                {{ option.label }}
              </option>
            }
          </select>
          <div class="field-help">Esta información es importante para emergencias médicas</div>
        </div>
      </div>

      <!-- Seguridad -->
      <div class="form-section">
        <h3 class="section-title">Seguridad</h3>
        
        <div class="form-group">
          <label for="password" class="form-label">
            Contraseña <span class="required">*</span>
          </label>
          <div class="password-input">
            <input 
              [type]="showPassword ? 'text' : 'password'" 
              id="password" 
              formControlName="password" 
              placeholder="Mínimo 6 caracteres"
              class="form-input"
              [class.form-input--error]="registerForm.get('password')?.invalid && registerForm.get('password')?.touched"
              (input)="checkPasswordStrength()"
            >
            <button 
              type="button" 
              class="toggle-password" 
              (click)="showPassword = !showPassword"
              [attr.aria-label]="showPassword ? 'Ocultar contraseña' : 'Mostrar contraseña'"
            >
              @if (!showPassword) {
                <svg 
                  xmlns="http://www.w3.org/2000/svg" 
                  width="18" 
                  height="18" 
                  viewBox="0 0 24 24" 
                  fill="none" 
                  stroke="currentColor" 
                  stroke-width="2" 
                  stroke-linecap="round" 
                  stroke-linejoin="round"
                >
                  <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                  <circle cx="12" cy="12" r="3"></circle>
                </svg>
              } @else {
                <svg 
                  xmlns="http://www.w3.org/2000/svg" 
                  width="18" 
                  height="18" 
                  viewBox="0 0 24 24" 
                  fill="none" 
                  stroke="currentColor" 
                  stroke-width="2" 
                  stroke-linecap="round" 
                  stroke-linejoin="round"
                >
                  <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path>
                  <line x1="1" y1="1" x2="23" y2="23"></line>
                </svg>
              }
            </button>
          </div>
          
          @if (registerForm.get('password')?.value) {
            <!-- Medidor de fortaleza simplificado -->
            <div class="password-strength">
              <div class="strength-bar">
                <div class="strength-fill" [ngClass]="passwordStrengthClass" [style.width.%]="passwordStrength"></div>
              </div>
              <span class="strength-text" [ngClass]="passwordStrengthClass">
                {{ passwordStrengthText }}
              </span>
            </div>
          }
          
          @if (registerForm.get('password')?.invalid && registerForm.get('password')?.touched) {
            <div class="error-message">
              @if (registerForm.get('password')?.errors?.['required']) {
                <span>La contraseña es requerida</span>
              }
              @if (registerForm.get('password')?.errors?.['minlength']) {
                <span>La contraseña debe tener al menos 6 caracteres</span>
              }
            </div>
          }
        </div>

        <div class="form-group">
          <label for="confirmPassword" class="form-label">
            Confirmar contraseña <span class="required">*</span>
          </label>
          <div class="password-input">
            <input 
              [type]="showConfirmPassword ? 'text' : 'password'" 
              id="confirmPassword" 
              formControlName="confirmPassword" 
              placeholder="Repita su contraseña"
              class="form-input"
              [class.form-input--error]="(registerForm.get('confirmPassword')?.invalid || registerForm.errors?.['passwordMismatch']) && registerForm.get('confirmPassword')?.touched"
            >
            <button 
              type="button" 
              class="toggle-password" 
              (click)="showConfirmPassword = !showConfirmPassword"
              [attr.aria-label]="showConfirmPassword ? 'Ocultar contraseña' : 'Mostrar contraseña'"
            >
              @if (!showConfirmPassword) {
                <svg 
                  xmlns="http://www.w3.org/2000/svg" 
                  width="18" 
                  height="18" 
                  viewBox="0 0 24 24" 
                  fill="none" 
                  stroke="currentColor" 
                  stroke-width="2" 
                  stroke-linecap="round" 
                  stroke-linejoin="round"
                >
                  <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                  <circle cx="12" cy="12" r="3"></circle>
                </svg>
              } @else {
                <svg 
                  xmlns="http://www.w3.org/2000/svg" 
                  width="18" 
                  height="18" 
                  viewBox="0 0 24 24" 
                  fill="none" 
                  stroke="currentColor" 
                  stroke-width="2" 
                  stroke-linecap="round" 
                  stroke-linejoin="round"
                >
                  <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path>
                  <line x1="1" y1="1" x2="23" y2="23"></line>
                </svg>
              }
            </button>
          </div>
          @if ((registerForm.get('confirmPassword')?.invalid || registerForm.errors?.['passwordMismatch']) && registerForm.get('confirmPassword')?.touched) {
            <div class="error-message">
              @if (registerForm.get('confirmPassword')?.errors?.['required']) {
                <span>Debe confirmar su contraseña</span>
              }
              @if (registerForm.errors?.['passwordMismatch']) {
                <span>Las contraseñas no coinciden</span>
              }
            </div>
          }
        </div>
      </div>

      <div class="form-actions">
        <button 
          type="submit" 
          class="btn-primary" 
          [disabled]="registerForm.invalid || isSubmitting"
        >
          @if (isSubmitting) {
            <span class="loading-spinner"></span>
            Creando cuenta...
          } @else {
            Crear cuenta
          }
        </button>

        <div class="auth-footer">
          <p>¿Ya tienes una cuenta? <a href="/login">Iniciar sesión</a></p>
        </div>
      </div>
    </form>
  </div>
</div>